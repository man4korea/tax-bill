# 🔐 공인인증서 비밀번호 관리 시스템 사용 가이드

HomeTax 세금계산서 자동화 시스템의 공인인증서 비밀번호 관리 기능 가이드입니다.

---

## 📋 시스템 개요

공인인증서 비밀번호 관리 시스템은 다음 기능을 제공합니다:

### 🔑 주요 기능
1. **자동로그인**: 비밀번호를 암호화하여 저장하고 자동으로 입력
2. **수동로그인**: 사용자가 직접 비밀번호를 입력하는 안전한 방식
3. **암호화 저장**: 비밀번호를 PBKDF2HMAC + AES 방식으로 안전하게 암호화
4. **기존 호환성**: 기존 .env 파일 방식과 완전 호환

---

## 🚀 실행 방법

### 1. 메인 UI에서 실행
```bash
# 메인 애플리케이션 실행
python core/hometax_main.py

# "🔐 공인인증서 비밀번호 관리" 버튼 클릭
```

### 2. 독립 실행
```bash
# 직접 실행
python core/hometax_cert_manager.py
```

---

## 🎯 사용법

### 자동로그인 모드 설정

#### 1단계: 로그인 방식 선택
- 🤖 **자동로그인 (비밀번호 저장)** 라디오버튼 선택

#### 2단계: 비밀번호 저장
1. **공인인증서 비밀번호** 입력 필드에 비밀번호 입력
2. **비밀번호 표시** 체크박스로 입력 확인 (선택사항)
3. **💾 비밀번호 저장** 버튼 클릭
4. 성공 메시지 확인

#### 3단계: 자동화 시작
- **🚀 HomeTax 자동화 시작** 버튼 클릭
- 자동으로 `hometax_quick.py`가 자동로그인 모드로 실행됨

### 수동로그인 모드 설정

#### 1단계: 로그인 방식 선택
- ✋ **수동로그인 (비밀번호 직접 입력)** 라디오버튼 선택

#### 2단계: 자동화 시작
- **🚀 HomeTax 자동화 시작** 버튼 클릭
- 홈택스 페이지에서 인증서 선택
- 비밀번호 입력창에서 직접 입력
- 시스템이 입력 감지 후 자동으로 다음 단계 진행

---

## 🔒 보안 기능

### 암호화 방식
- **알고리즘**: PBKDF2HMAC + AES (Fernet)
- **키 길이**: 256비트
- **반복 횟수**: 100,000회
- **솔트**: 고정값 (운영 시 랜덤 권장)

### 저장 위치
1. **암호화 파일**: `cert_config.enc` (주 저장소)
2. **백업 파일**: `.env` 파일 (기존 호환성)

### 비밀번호 관리
- **표시/숨기기**: 입력 중 비밀번호 표시 여부 선택 가능
- **안전한 삭제**: 저장된 비밀번호 완전 삭제 기능
- **자동 검증**: 저장/로드 시 데이터 무결성 검증

---

## 🛠️ 설치 및 의존성

### 필수 패키지 설치
```bash
# 기본 설치
pip install -r requirements.txt

# 개별 설치
pip install cryptography>=41.0.0
pip install ttkbootstrap>=1.10.0
pip install playwright>=1.52.0
```

### 시스템 요구사항
- **Python**: 3.8 이상
- **운영체제**: Windows 10/11
- **브라우저**: Firefox (Playwright)

---

## 🔧 고급 설정

### 환경변수 설정
```bash
# 로그인 모드 지정 (자동화 스크립트에서 사용)
HOMETAX_LOGIN_MODE=auto    # 자동로그인
HOMETAX_LOGIN_MODE=manual  # 수동로그인
```

### 파일 구조
```
C:\APP\tax-bill\
├── core/
│   ├── hometax_cert_manager.py    # 비밀번호 관리 UI
│   ├── hometax_main.py            # 메인 UI (연동됨)
│   └── hometax_quick.py           # 자동화 스크립트 (수정됨)
├── cert_config.enc                # 암호화된 설정 파일
└── .env                          # 백업 설정 파일
```

---

## 🐛 문제 해결

### 일반적인 문제

#### 1. "cryptography 모듈을 찾을 수 없습니다"
```bash
pip install cryptography>=41.0.0
```

#### 2. "비밀번호 저장 실패"
- 파일 권한 확인: 실행 폴더에 쓰기 권한 필요
- 바이러스 백신 소프트웨어 예외 추가

#### 3. "자동로그인 실패"
- 저장된 비밀번호 확인: 상태 표시에서 "있음 ✓" 확인
- .env 파일 확인: `PW=your_password` 형식 점검

#### 4. "수동로그인 감지 안됨"
- 비밀번호 입력 후 잠시 대기 (최대 1초)
- 브라우저 개발자 도구에서 `#input_cert_pw` 요소 확인

### 디버그 모드
```python
# 독립 실행 시 디버그 정보 출력
if __name__ == "__main__":
    import logging
    logging.basicConfig(level=logging.DEBUG)
    main()
```

---

## 📊 로그 및 모니터링

### 실행 로그 예시
```
로그인 모드: auto
=== 엑셀 파일 선택 및 거래명세표 행 선택 ===
비밀번호 자동 입력...
비밀번호 자동 입력 완료
확인 버튼 클릭...
로그인 성공! 인증서 창 사라짐 확인
```

### 수동 모드 로그 예시
```
로그인 모드: manual
수동 입력 모드: 비밀번호를 직접 입력하세요
비밀번호 입력 필드: #input_cert_pw
여기서 수동입력 대기
비밀번호를 입력하면 #input_cert_pw 셀렉션에 입력된 값을 이용하여 다음 자동화 프로세스 진행
비밀번호 입력 감지됨 (길이: 8)
수동 비밀번호 입력 완료 감지
```

---

## 🔄 업데이트 및 마이그레이션

### 기존 .env 파일에서 마이그레이션
1. 기존 .env 파일의 `PW=` 값이 자동으로 감지됨
2. 비밀번호 관리 UI에서 **💾 비밀번호 저장** 클릭
3. 암호화된 `cert_config.enc` 파일 자동 생성
4. 기존 .env 파일도 백업으로 유지됨

### 버전 호환성
- **v1.x**: .env 파일만 지원
- **v2.x**: .env + 암호화 파일 지원 (현재 버전)
- **향후**: 클라우드 동기화, 다중 인증서 지원 예정

---

## 📞 지원 및 문의

### 기술 지원
- **개발자**: Claude AI Assistant  
- **프로젝트**: HomeTax Automation System v2.0
- **문서 버전**: 1.0.0
- **최종 업데이트**: 2024년 8월 28일

### 추가 리소스
- **메인 가이드**: `CLAUDE.md`
- **배포 가이드**: `docs/DEPLOYMENT_GUIDE.md`
- **필드 매핑**: `docs/field_mapping.md`

---

**© 2024 HomeTax Automation System. All rights reserved.**